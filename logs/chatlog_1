–í —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –æ–±—â–∞–µ–º—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
–°–æ–∑–¥–∞–π .gitingore –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞.


–î–æ–±–∞–≤–∏–ª –∫–æ—Ä–Ω–µ–≤–æ–π .gitignore (.gitignore:1), –≤–∫–ª—é—á–∏–≤ —Ç–∏–ø–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ/IDE —Ñ–∞–π–ª—ã, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã Python, –ª–æ–≥–∏ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ .env, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
–£—á—ë–ª –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤ (Node.js) ‚Äî node_modules, –∫—ç—à–∏ —Å–±–æ—Ä—â–∏–∫–æ–≤, Yarn Berry —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ ‚Äî –¥–ª—è –æ–±–µ–∏—Ö –≤–∏—Ç—Ä–∏–Ω.
–î–æ–±–∞–≤–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è docker-compose.override.yml –∏ .docker/, –æ—Å—Ç–∞–≤–∏–≤ –ø—Ä–∏ —ç—Ç–æ–º .env.example –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.
–ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å git status, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã –≤—Ä–æ–¥–µ venv/ —Ç–µ–ø–µ—Ä—å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

1 file changed

Undo

View all changes
.gitignore
+63
-0

–¥–æ–±–∞–≤—å –ø–∞–ø–∫—É .old –≤ .gitignore


–î–æ–±–∞–≤–∏–ª /.old/ –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö –ø—É—Ç–µ–π (.gitignore:6), —á—Ç–æ–±—ã –∞—Ä—Ö–∏–≤–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å git status –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–∫–∏–µ –ø–∞–ø–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

1 file changed

Undo

View all changes
.gitignore
+1
-0

–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –≤ —Å—Ä–µ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏


–î–æ–±–∞–≤–∏–ª —Å–ø–∏—Å–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π bot/requirements.txt:1 –∏ bot/requirements-dev.txt:1, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å runtime –∏ dev‚Äë–ø–∞–∫–µ—Ç—ã –±–µ–∑ —É–ø–∞–∫–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞.
–û–±–Ω–æ–≤–∏–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ bot/README.md:161, —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ pip install -r requirements-dev.txt, –∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ requirements.txt.
–£—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ venv –∫–æ–º–∞–Ω–¥–æ–π .\venv\Scripts\python.exe -m pip install -r bot\requirements-dev.txt; pip freeze –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ aiogram, taskiq, psycopg –∏ –¥—Ä.
–î–∞–ª—å—à–µ –º–æ–∂–Ω–æ:

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (.\venv\Scripts\activate) –∏ –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è bot\.env –∑–∞–ø—É—Å—Ç–∏—Ç—å python bot\main.py.
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π requirements-—Ñ–∞–π–ª.
3 files changed
+19
-5

Undo

View all changes
README.md
+5
-5

requirements-dev.txt
+2
-0

requirements.txt
+12
-0

—Å–¥–µ–ª–∞–π ,env –∏–∑ example


–°–æ–∑–¥–∞–ª —Ä–∞–±–æ—á–∏–π bot/.env, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–∑ bot/.env.example. –ú–æ–∂–µ—à—å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤/ID –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞.

(venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\main.py", line 6, in <module>
from app.bot import main
File "F:\WORK\Python\shariat-from-template\bot\app\bot_init_.py", line 1, in <module>
from .bot import main
File "F:\WORK\Python\shariat-from-template\bot\app\bot\bot.py", line 4, in <module>
import psycopg_pool
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool_init_.py", line 7, in <module>
from .pool import ConnectionPool
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool.py", line 22, in <module>
from psycopg import errors as e
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_init_.py", line 9, in <module>
from . import pq # noqa: F401 import early to stabilize side effects
^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\pq_init_.py", line 116, in <module>
import_from_libpq()
~~~~~~~~~~~~~~~~~^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\pq_init_.py", line 108, in import_from_libpq
raise ImportError(
...<4 lines>...
)
ImportError: no pq wrapper available.
Attempts made:

couldn't import psycopg 'c' implementation: No module named 'psycopg_c'
couldn't import psycopg 'binary' implementation: No module named 'psycopg_binary'
couldn't import psycopg 'python' implementation: libpq library not found

–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ü–µ—Ä–µ–∫–ª—é—á–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–∞ –±–∏–Ω–∞—Ä–Ω—É—é —Å–±–æ—Ä–∫—É psycopg[binary] (bot/pyproject.toml:11, bot/requirements.txt:8, bot/requirements-dev.txt:1), —á—Ç–æ–±—ã libpq –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥ Windows.
–î–æ–±–∞–≤–∏–ª —è–≤–Ω—ã–µ requirements*.txt –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏–ª –æ–∫—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∏—Ö ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è –±–æ—Ç–∞ —Å—Ç–∞–≤—è—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–ª bot/config/settings.toml:1, —É–±—Ä–∞–≤ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∑–∞–¥–∞–≤ –≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è dev-—Å—Ä–µ–¥—ã (localhost/5453 –∏ —Ç.–¥.), —á—Ç–æ–±—ã Dynaconf —Å–º–æ–≥ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥.
–ü—Ä–æ–≤–µ—Ä–∫–∞

pip show psycopg-binary –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞, –∏–º–ø–æ—Ä—Ç psycopg —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏—Ç.
–ó–∞–ø—É—Å–∫ python bot/main.py –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è; –¥–∞–ª—å—à–µ –ø–∞–¥–∞–µ—Ç —Å nats.errors.NoServersError, –ø–æ—Ç–æ–º—É —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω NATS (–æ–∂–∏–¥–∞–µ–º–æ: –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è—Ç—ã).
–ß—Ç–æ –¥–∞–ª—å—à–µ

–ü–æ–¥–Ω—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Postgres, Redis, NATS) ‚Äî –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ docker compose up –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.
–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å python bot/main.py, –ª–∏–±–æ –¥–µ—Ä–∂–∞—Ç—å –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ python -m app.bot.
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π requirements*.txt –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å pip install -r ..., —á—Ç–æ–±—ã —Å—Ä–µ–¥–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π.
3 files changed
+21
-19

Undo

View all changes
settings.toml
+19
-17

pyproject.toml
+1
-1

requirements.txt
+1
-1

(venv) PS F:\WORK\Python\shariat-from-template> docker compose up
unable to get image 'postgres:17-alpine': error during connect: Get "http://%2F%2F.%2Fpipe%2FdockerDesktopLinuxEngine/v1.51/images/postgres:17-alpine/json": open //./pipe/dockerDesktopLinuxEngine: The system cannot find the file specified.


–ö–æ–º–∞–Ω–¥–∞ —É–ø–∞–ª–∞ –ø–æ—Ç–æ–º—É, —á—Ç–æ Docker Engine —Å–µ–π—á–∞—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: –∫–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–æ–∫–µ—Ç—É //./pipe/dockerDesktopLinuxEngine, –Ω–æ —Å–ª—É–∂–±–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞.
–ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ –º–µ–Ω—é ¬´–ü—É—Å–∫¬ª –∏–ª–∏ —è—Ä–ª—ã–∫ –≤ —Ç—Ä–µ–µ) –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ ¬´Docker Desktop is running¬ª.
–ï—Å–ª–∏ Desktop –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ —Å —Å–∞–π—Ç–∞ Docker, –≤–∫–ª—é—á–∏—Ç–µ WSL‚ÄØ2 (–∏–ª–∏ Hyper-V) –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–∞—à–∏–Ω—É.
–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –¥–≤–∏–∂–∫–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å docker info; –∫–æ–≥–¥–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—á–Ω—ë—Ç –æ—Ç–≤–µ—á–∞—Ç—å, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π docker compose up —Å–æ–±–µ—Ä—ë—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
(venv) PS F:\WORK\Python\shariat-from-template> docker compose up
[+] Running 9/9
‚úî redis Pulled 30.2s
‚úî 491cac7f2e45 Pull complete 0.4s
‚úî 3881684f3863 Pull complete 0.4s
‚úî f637881d1138 Pull complete 4.3s
‚úî 7f2a16ba242b Pull complete 6.3s
‚úî 39cb007b6d10 Pull complete 0.5s
‚úî 516a54ddb544 Pull complete 2.7s
‚úî 4f4fb700ef54 Pull complete 0.0s
‚úî fcf08622f74c Pull complete 1.2s
[+] Building 4.5s (6/9)
=> [internal] load local bake definitions 0.0s
=> => reading from stdin 2.61kB 0.0s
=> [react-admin internal] load build definition from Dockerfile 0.3s
=> => transferring dockerfile: 212B 0.0s
=> [bot internal] load build definition from Dockerfile 0.2s
=> => transferring dockerfile: 2B 0.0s
=> [backend internal] load build definition from Dockerfile 0.2s
=> => transferring dockerfile: 248B 0.0s
=> [vue-portal internal] load build definition from Dockerfile 0.2s
=> => transferring dockerfile: 212B 0.0s
=> [nginx internal] load build definition from Dockerfile 0.3s
=> => transferring dockerfile: 98B 0.0s
=> [backend internal] load metadata for docker.io/library/python:3.12-slim 3.1s
=> CANCELED [vue-portal internal] load metadata for docker.io/library/node:20-alpine 3.1s
=> [nginx internal] load metadata for docker.io/library/nginx:1.27-alpine 3.1s
target bot: failed to solve: failed to read dockerfile: open Dockerfile: no such file or directory


–î–ª—è —Å–µ—Ä–≤–∏—Å–∞ bot –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ Dockerfile, –ø–æ—ç—Ç–æ–º—É —Å–±–æ—Ä–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–ª–∞—Å—å –Ω–∞ —à–∞–≥–µ target bot. –°–æ–∑–¥–∞–ª bot/Dockerfile:1: –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ python:3.12-slim, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ requirements.txt, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø—É—Å–∫ python main.py.
–ü—Ä–æ–≤–µ—Ä–∏–ª —Å–±–æ—Ä–∫—É –∫–æ–º–∞–Ω–¥–æ–π docker compose build bot ‚Äî –æ–±—Ä–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω –∏–∑ –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç—è–Ω—É–ª–∏—Å—å, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π/–æ—à–∏–±–æ–∫ –Ω–µ—Ç.
–î–∞–ª—å—à–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ docker compose up --build (–∏–ª–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã), –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –≤ .env –ø—Ä–æ–ø–∏—Å–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π BOT_TOKEN –∏ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã.

1 file changed

Undo

View all changes
Dockerfile
+13
-0

—Å–µ–π—á–∞—Å –±–æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —â–∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ –≤ IDE, –¥–∞–≤–∞–π –ø–æ–∫–∞ –±–µ–∑ –¥–æ–∫–µ—Ä–∞


–î–æ–±–∞–≤–∏–ª –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –≤ bot/config/settings.toml:1 –∏ :24: –≤ –¥–µ–≤-–ø—Ä–æ—Ñ–∏–ª–µ —Ç–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω—ã NATS –∏ Taskiq, –ø–æ—ç—Ç–æ–º—É –±–æ—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ MemoryStorage –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.
–ü–µ—Ä–µ–ø–∏—Å–∞–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ bot/app/bot/bot.py:36 ‚Äî –∫–æ–≥–¥–∞ NATS –≤—ã–∫–ª—é—á–µ–Ω, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ FSM –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏, –∑–∞–ø—É—Å–∫ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Å—é–º–µ—Ä–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –∞ redis_source –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏.
–°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–ª –∑–∞–≥–ª—É—à–∫—É –±—Ä–æ–∫–µ—Ä–∞ –≤ bot/app/services/scheduler/taskiq_broker.py:1: –¥–æ–±–∞–≤–∏–ª Stub —Å –º–µ—Ç–æ–¥–∞–º–∏ task, startup, shutdown, —á—Ç–æ–±—ã Taskiq-–∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∞–ª–∏—Å—å, –Ω–æ –∫–æ–¥ –æ—Å—Ç–∞–≤–∞–ª—Å—è —Ä–∞–±–æ—á–∏–º.
–û–±–Ω–æ–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ bot/app/bot/handlers/commands.py:1, —á—Ç–æ–±—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ js/redis_source —Å—Ç–∞–ª–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∏ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
–í bot/README.md:154 –æ–ø–∏—Å–∞–ª —à–∞–≥–∏ ¬´Debug –±–µ–∑ Docker¬ª ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º Compose, –æ—Å—Ç–∞–≤–ª—è–µ–º ENABLE_NATS/TASKIQ = false, –∑–∞–ø—É—Å–∫–∞–µ–º python bot/main.py.
–ü—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–ø—É—Å–∫ python bot/main.py —Å–µ–π—á–∞—Å –ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Postgres (–æ–∂–∏–¥–∞–µ–º–æ, –ø–æ–∫–∞ –ë–î –Ω–µ –ø–æ–¥–Ω—è—Ç–∞). –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ë–î –±–æ—Ç –ø–æ–π–¥—ë—Ç –≤ –æ–±—ã—á–Ω—ã–π polling; –∫–æ–º–∞–Ω–¥—ã, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç NATS/Taskiq, –±—É–¥—É—Ç —Å–æ–æ–±—â–∞—Ç—å, —á—Ç–æ —Ñ–∏—á–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞.

–î–∞–ª—å—à–µ —Å—Ç–æ–∏—Ç:

–ü–æ–¥–Ω—è—Ç—å PostgreSQL (–∏–ª–∏ –ø–æ–ø—Ä–∞–≤–∏—Ç—å —Ö–æ—Å—Ç/–ø–æ—Ä—Ç –≤ settings.toml) –∏ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å python bot/main.py.
–ö–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –≤–µ—Ä–Ω—É—Ç—å ENABLE_NATS/ENABLE_TASKIQ –≤ true, –∑–∞–ø—É—Å—Ç–∏—Ç—å NATS/Redis/Taskiq –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.
5 files changed
+188
-58

Undo

View all changes
README.md
+19
-0

bot.py
+50
-28

commands.py
+60
-11

taskiq_broker.py
+51
-19

settings.toml
+8
-0

(venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
[2025-10-09 21:11:35,664] #DEBUG selector_events.py:64 - asyncio - Using selector: SelectSelector
[2025-10-09 21:11:35,665] #INFO bot.py:37 - app.bot.bot - Starting bot
[2025-10-09 21:11:35,875] #DEBUG connect_to_pg.py:22 - app.infrastructure.database.connection.connect_to_pg - Building PostgreSQL connection string (password omitted): postgresql://postgres@localhost:5453/postgres
[2025-10-09 21:12:05,883] #ERROR connect_to_pg.py:88 - app.infrastructure.database.connection.connect_to_pg - Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\connect_to_pg.py", line 83, in get_pg_pool
async with db_pool.connection() as connection:
~~~~~~~~~~~~~~~~~~^^
File "C:\Python313\Lib\contextlib.py", line 214, in aenter
return await anext(self.gen)
^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 195, in connection
conn = await self.getconn(timeout=timeout)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 230, in getconn
raise PoolTimeout(
f"couldn't get a connection after {timeout:.2f} sec"
) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\main.py", line 16, in <module>
asyncio.run(main())
~~~~~~~~~~~^^^^^^^^
File "C:\Python313\Lib\asyncio\runners.py", line 195, in run
return runner.run(main)
~~~~~~~~~~^^^^^^
File "C:\Python313\Lib\asyncio\runners.py", line 118, in run
return self._loop.run_until_complete(task)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
File "C:\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
return future.result()
~~~~~~~~~~~~~^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\bot.py", line 66, in main
db_pool: psycopg_pool.AsyncConnectionPool = await get_pg_pool(
^^^^^^^^^^^^^^^^^^
...<5 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\connect_to_pg.py", line 83, in get_pg_pool
async with db_pool.connection() as connection:
~~~~~~~~~~~~~~~~~~^^
File "C:\Python313\Lib\contextlib.py", line 214, in aenter
return await anext(self.gen)
^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 195, in connection
conn = await self.getconn(timeout=timeout)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 230, in getconn
raise PoolTimeout(
f"couldn't get a connection after {timeout:.2f} sec"
) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec


–ë–æ—Ç —É–∂–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –¥–∞–ª—å—à–µ –µ–º—É –Ω—É–∂–µ–Ω –∂–∏–≤–æ–π PostgreSQL ‚Äî –∏–∑‚Äë–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç. –ï—Å—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

–ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ.

–ü—Ä–æ—â–µ –≤—Å–µ–≥–æ –ø–æ–¥–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–∞–∑–æ–π:
docker compose up postgres
–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ:
docker run --rm -p 5453:5432 -e POSTGRES_DB=postgres `
  -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgres postgres:17-alpine
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 5453 —Å–≤–æ–±–æ–¥–µ–Ω, –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
psql -h localhost -p 5453 -U postgres -d postgres -c "select 1;"
(–ø–∞—Ä–æ–ª—å postgres). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ python bot/main.py –ø—Ä–æ–π–¥—ë—Ç.
–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—É—é –ë–î.
–ï—Å–ª–∏ —É –≤–∞—Å –≥–¥–µ-—Ç–æ –∫—Ä—É—Ç–∏—Ç—Å—è Postgres, –ø–æ–º–µ–Ω—è–π—Ç–µ HOST/PORT/USER/PASSWORD –≤ —Å–µ–∫—Ü–∏–∏ [development.postgres] —Ñ–∞–π–ª–∞ bot/config/settings.toml, –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç–µ bot/.env –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç —Å–Ω–æ–≤–∞.

–ë–µ–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ë–î –±–æ—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç, –ø–æ—ç—Ç–æ–º—É –æ—Ç–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ NATS/Taskiq –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ö–∞–∫ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã —Å –±–∞–∑–æ–π ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ, –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –æ—à–∏–±–∫–∏ —É–∂–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å –ø–æ –º–µ—Å—Ç—É.

(venv) PS F:\WORK\Python\shariat-from-template\bot> docker compose up postgres
[+] Running 3/3
‚úî Network shariat-from-template_shariat Created 0.4s
‚úî Volume "shariat-from-template_pgdata" Created 0.0s
‚úî Container shariat_postgres Created 0.1s
Attaching to shariat_postgres
shariat_postgres | The files belonging to this database system will be owned by user "postgres".
shariat_postgres | This user must also own the server process.
shariat_postgres |
shariat_postgres | The database cluster will be initialized with locale "en_US.utf8".
shariat_postgres | The default database encoding has accordingly been set to "UTF8".
shariat_postgres | The default text search configuration will be set to "english".
shariat_postgres |
shariat_postgres | Data page checksums are disabled.
shariat_postgres |
shariat_postgres | fixing permissions on existing directory /var/lib/postgresql/data ... ok
shariat_postgres | creating subdirectories ... ok
shariat_postgres | selecting dynamic shared memory implementation ... posix
shariat_postgres | selecting default "max_connections" ... 100
shariat_postgres | selecting default "shared_buffers" ... 128MB
shariat_postgres | selecting default time zone ... UTC
shariat_postgres | creating configuration files ... ok
shariat_postgres | running bootstrap script ... ok
shariat_postgres | sh: locale: not found
shariat_postgres | 2025-10-09 18:23:30.384 UTC [35] WARNING: no usable system locales were found
shariat_postgres | performing post-bootstrap initialization ... ok
shariat_postgres | initdb: warning: enabling "trust" authentication for local connections
shariat_postgres | initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
shariat_postgres | syncing data to disk ... ok
shariat_postgres |
shariat_postgres |
shariat_postgres | Success. You can now start the database server using:
shariat_postgres |
shariat_postgres | pg_ctl -D /var/lib/postgresql/data -l logfile start
shariat_postgres |
shariat_postgres | waiting for server to start....2025-10-09 18:23:31.330 UTC [41] LOG: starting PostgreSQL 17.6 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
shariat_postgres | 2025-10-09 18:23:31.335 UTC [41] LOG: listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
shariat_postgres | 2025-10-09 18:23:31.348 UTC [44] LOG: database system was shut down at 2025-10-09 18:23:30 UTC
shariat_postgres | 2025-10-09 18:23:31.356 UTC [41] LOG: database system is ready to accept connections
shariat_postgres | done
shariat_postgres | server started
shariat_postgres | CREATE DATABASE
shariat_postgres |
shariat_postgres |
shariat_postgres | /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
shariat_postgres |
shariat_postgres | waiting for server to shut down....2025-10-09 18:23:31.476 UTC [41] LOG: received fast shutdown request
shariat_postgres | 2025-10-09 18:23:31.481 UTC [41] LOG: aborting any active transactions
shariat_postgres | 2025-10-09 18:23:31.483 UTC [41] LOG: background worker "logical replication launcher" (PID 47) exited with exit code 1
shariat_postgres | 2025-10-09 18:23:31.483 UTC [42] LOG: shutting down
shariat_postgres | 2025-10-09 18:23:31.488 UTC [42] LOG: checkpoint starting: shutdown immediate
shariat_postgres | 2025-10-09 18:23:31.672 UTC [42] LOG: checkpoint complete: wrote 925 buffers (5.6%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.026 s, sync=0.142 s, total=0.189 s; sync files=301, longest=0.005 s, average=0.001 s; distance=4255 kB, estimate=4255 kB; lsn=0/19150D0, redo lsn=0/19150D0
shariat_postgres | 2025-10-09 18:23:31.679 UTC [41] LOG: database system is shut down
shariat_postgres | done shariat_postgres | 2025-10-09 18:23:31.483 UTC [41] LOG: background worker "logical replication launcher" (PID 47) exited with exit code 1
shariat_postgres | 2025-10-09 18:23:31.483 UTC [42] LOG: shutting down
shariat_postgres | 2025-10-09 18:23:31.488 UTC [42] LOG: checkpoint starting: shutdown immediate
shariat_postgres | 2025-10-09 18:23:31.672 UTC [42] LOG: checkpoint complete: wrote 925 buffers (5.6%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.026 s, sync=0.142 s, total=0.189 s; sync files=301, longest=0.005 s, average=0.001 s; distance=4255 kB, estimate=4255 kB; lsn=0/19150D0, redo lsn=0/19150D0
shariat_postgres | 2025-10-09 18:23:31.679 UTC [41] LOG: database system is shut down
shariat_postgres | done
shariat_postgres | server stopped
shariat_postgres |
shariat_postgres | PostgreSQL init process complete; ready for start up.
shariat_postgres |
shariat_postgres | 2025-10-09 18:23:31.804 UTC [1] LOG: starting PostgreSQL 17.6 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
shariat_postgres | 2025-10-09 18:23:31.805 UTC [1] LOG: listening on IPv4 address "0.0.0.0", port 5432
shariat_postgres | 2025-10-09 18:23:31.806 UTC [1] LOG: listening on IPv6 address "::", port 5432
shariat_postgres | 2025-10-09 18:23:31.817 UTC [1] LOG: listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
shariat_postgres | 2025-10-09 18:23:31.828 UTC [57] LOG: database system was shut down at 2025-10-09 18:23:31 UTC
shariat_postgres | 2025-10-09 18:23:31.836 UTC [1] LOG: database system is ready to accept connections

shariat_postgres | 2025-10-09 18:28:32.759 UTC [55] LOG: checkpoint starting: time
shariat_postgres | 2025-10-09 18:28:37.205 UTC [55] LOG: checkpoint complete: wrote 47 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.418 s, sync=0.013 s, total=4.447 s; sync files=12, longest=0.005 s, average=0.002 s; distance=270 kB, estimate=270 kB; lsn=0/19589B0, redo lsn=0/1958958

–±–∞–∑–∞ –≤–∏—Å–∏—Ç?


–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–∏–≤ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî —Å—É–¥—è –ø–æ –ª–æ–≥—É, –æ–Ω —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –∏ –∂–¥—ë—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ 5432. –ü—É–ª –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–∞–¥–∞–ª, –ø–æ—Ç–æ–º—É —á—Ç–æ Postgres –Ω–µ –±—ã–ª –ø—Ä–æ–±—Ä–æ—à–µ–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç 5453, –∞ –µ—â—ë –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥–Ω–∏–º–∞–ª—Å—è —Å –¥—Ä—É–≥–∏–º–∏ user/db. –Ø –ø–æ–ø—Ä–∞–≤–∏–ª docker-compose.yml (docker-compose.yml:5): —Ç–µ–ø–µ—Ä—å –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –ø–æ—Ä—Ç 5453:5432, –∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å dev-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (postgres/postgres).

–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É:

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —Å–±—Ä–æ—Å–∏—Ç—å volume (–∏–Ω–∞—á–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ë–î —Å –ø—Ä–µ–∂–Ω–∏–º–∏ –ª–æ–≥–∏–Ω–∞–º–∏):
docker compose down -v
–ó–∞–ø—É—Å—Ç–∏—Ç—å Postgres –∑–∞–Ω–æ–≤–æ –≤ —Ñ–æ–Ω–µ:
docker compose up -d postgres
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç:
docker compose ps
# –∏–ª–∏
psql -h localhost -p 5453 -U postgres -d postgres -c "select 1;"
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫ python bot/main.py –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ –¥–∞–ª—å—à–µ (–±–æ—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –ë–î; –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã ‚Äî NATS/Taskiq ‚Äî –ø–æ‚Äë–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ dev-–∫–æ–Ω—Ñ–∏–≥–µ).
1 file changed

Undo

View all changes
docker-compose.yml
+5
-3

(venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
[2025-10-10 00:36:15,301] #DEBUG selector_events.py:64 - asyncio - Using selector: SelectSelector
[2025-10-10 00:36:15,303] #INFO bot.py:37 - app.bot.bot - Starting bot
[2025-10-10 00:36:15,518] #DEBUG connect_to_pg.py:22 - app.infrastructure.database.connection.connect_to_pg - Building PostgreSQL connection string (password omitted): postgresql://postgres@localhost:5453/postgres
[2025-10-10 00:36:45,523] #ERROR connect_to_pg.py:88 - app.infrastructure.database.connection.connect_to_pg - Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\connect_to_pg.py", line 83, in get_pg_pool
async with db_pool.connection() as connection:
~~~~~~~~~~~~~~~~~~^^
File "C:\Python313\Lib\contextlib.py", line 214, in aenter
return await anext(self.gen)
^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 195, in connection
conn = await self.getconn(timeout=timeout)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 230, in getconn
raise PoolTimeout(
f"couldn't get a connection after {timeout:.2f} sec"
) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\main.py", line 16, in <module>
asyncio.run(main())
~~~~~~~~~~~^^^^^^^^
File "C:\Python313\Lib\asyncio\runners.py", line 195, in run
return runner.run(main)
~~~~~~~~~~^^^^^^
File "C:\Python313\Lib\asyncio\runners.py", line 118, in run
return self._loop.run_until_complete(task)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
File "C:\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
return future.result()
~~~~~~~~~~~~~^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\bot.py", line 66, in main
db_pool: psycopg_pool.AsyncConnectionPool = await get_pg_pool(
^^^^^^^^^^^^^^^^^^
...<5 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\connect_to_pg.py", line 83, in get_pg_pool
async with db_pool.connection() as connection:
~~~~~~~~~~~~~~~~~~^^
File "C:\Python313\Lib\contextlib.py", line 214, in aenter
return await anext(self.gen)
^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 195, in connection
conn = await self.getconn(timeout=timeout)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg_pool\pool_async.py", line 230, in getconn
raise PoolTimeout(
f"couldn't get a connection after {timeout:.2f} sec"
) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec


–ü—É–ª —Å–Ω–æ–≤–∞ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ Postgres –≤—Å—ë –µ—â—ë –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ localhost:5453. –°—É–¥—è –ø–æ –ª–æ–≥—É, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥–Ω—è—Ç, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ –Ω–µ–≥–æ ¬´–Ω–µ –¥–æ—Å—Ç—É–∫–∏–≤–∞–µ—Ç—Å—è¬ª. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–º–µ—Å—Ç–µ —Å volume (–≤–∞–∂–Ω–æ, –∏–Ω–∞—á–µ Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é):

cd F:\WORK\Python\shariat-from-template
docker compose down -v
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ Postgres –∑–∞–Ω–æ–≤–æ –≤ —Ñ–æ–Ω–µ:

docker compose up -d postgres
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–æ–±—Ä–æ—à–µ–Ω –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç:

docker compose ps
–í –∫–æ–ª–æ–Ω–∫–µ Ports –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.0.0.0:5453->5432/tcp.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ Windows:

Test-NetConnection -ComputerName localhost -Port 5453
–∏–ª–∏, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω psql:

psql -h localhost -p 5453 -U postgres -d postgres -c "select 1;"
–ü–∞—Ä–æ–ª—å ‚Äî postgres.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

python .\main.py
–ï—Å–ª–∏ Test-NetConnection –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –ø–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç, –∑–Ω–∞—á–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —É—Å–ø–µ–ª –ø–æ–¥–Ω—è—Ç—å—Å—è –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Ñ–∞–µ—Ä–≤–æ–ª–æ–º. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ø—Ä–∏—à–ª–∏—Ç–µ –≤—ã–≤–æ–¥ docker compose ps ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

venv) PS F:\WORK\Python\shariat-from-template> docker compose ps
NAME IMAGE COMMAND SERVICE CREATED STATUS PORTS
shariat_postgres postgres:17-alpine "docker-entrypoint.s‚Ä¶" postgres 6 seconds ago Up 6 seconds 0.0.0.0:5453->5432/tcp, [::]:5453->5432/tcp
Test-NetConnection –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
–£ –º–µ–Ω—è —Å—Ç–æ–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π postgres –Ω–∞ 5432. –ù–µ –º–æ–∂–µ—Ç –æ–Ω –º–µ—à–∞—Ç—å?


–õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL –Ω–∞ 5432 –Ω–∏–∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º: –º—ã –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç 5453:5432 (docker-compose.yml:5), –ø–æ—ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å—ã —Å–ª—É—à–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã.
Test-NetConnection –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TcpTestSucceeded : False, –∑–Ω–∞—á–∏—Ç Windows —Ç–∞–∫ –∏ –Ω–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º. –ß–∞—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ –ª–∏–±–æ –µ—â—ë –Ω–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –ª–∏–±–æ –∑–∞–ø—Ä–µ—Ç –≤ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–µ.
–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–Ω—è—Ç –∏ —Å–ª—É—à–∞–µ—Ç 5453 ‚Äî –≤—ã–≤–æ–¥ docker compose ps —É–∂–µ —ç—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ docker logs shariat_postgres, —Ç–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ database system is ready to accept connections.
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –Ω–∞–ø—Ä—è–º—É—é:
psql -h localhost -p 5453 -U postgres -d postgres -c "select 1;"
(–ø–∞—Ä–æ–ª—å postgres). –ï—Å–ª–∏ psql –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
docker exec -it shariat_postgres psql -U postgres -d postgres -c "select 1;"
–ï—Å–ª–∏ Windows –ø–æ‚Äë–ø—Ä–µ–∂–Ω–µ–º—É –Ω–µ –¥–∞—ë—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, —á–∞—â–µ –≤–∏–Ω–æ–≤–∞—Ç –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Docker Desktop ‚Äî –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Windows —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø; –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ ¬´–ù–µ—Ç¬ª, –ø–æ—Ä—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞–∫—Ä—ã—Ç—ã–º.
–ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤ bot/config/settings.toml ([development.postgres].HOST) –∏ –≤ bot/.env —Ö–æ—Å—Ç localhost ‚Üí 127.0.0.1, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ IPv6‚Äë—Ä–µ–∑–æ–ª—å–≤–∞.
–ö–∞–∫ —Ç–æ–ª—å–∫–æ psql –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å, –±–æ—Ç —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.

—è –ø–æ–º–µ–Ω—è–ª –ø–æ—Ä—Ç –Ω–∞ 5466, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –±–æ—Ç –Ω–µ –≤–∏–¥–∏—Ç postgres


–ü–æ—Ö–æ–∂–µ, –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Å—Ç—É—á–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—ã–π –ø–æ—Ä—Ç 5453 ‚Äî dynaconf –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ settings.toml, –∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–∏–¥–∞ POSTGRES_PORT –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª—é—á settings.postgres.port. –Ø –æ–±–Ω–æ–≤–∏–ª dev‚Äë–∫–æ–Ω—Ñ–∏–≥ (bot/config/settings.toml:24): —Ç–µ–ø–µ—Ä—å Postgres –æ–∂–∏–¥–∞–µ—Ç—Å—è –Ω–∞ 127.0.0.1:5466.

–ß—Ç–æ –µ—â—ë —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å:

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —á—Ç–æ–±—ã –æ–Ω —Ä–µ–∞–ª—å–Ω–æ —Å–ª—É—à–∞–ª –Ω–æ–≤—ã–π –ø–æ—Ä—Ç:
docker compose down -v
docker compose up -d postgres
docker compose ps    # –≤ —Å—Ç–æ–ª–±—Ü–µ Ports –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.0.0.0:5466->5432/tcp
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:
Test-NetConnection -ComputerName 127.0.0.1 -Port 5466
(–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω psql, –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å psql -h 127.0.0.1 -p 5466 -U postgres -d postgres -c "select 1;").
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:
python .\main.py
–ï—Å–ª–∏ Test-NetConnection –≤—Å—ë –µ—â—ë –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False, –∑–Ω–∞—á–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è ‚Äî –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –Ω–∞–¥–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å Docker Desktop –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å. But now bot uses port 5466 so once connection works it should start.

1 file changed

Undo

View all changes
settings.toml
+2
-2

(venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
[2025-10-11 10:15:13,950] #DEBUG selector_events.py:64 - asyncio - Using selector: SelectSelector
[2025-10-11 10:15:13,951] #INFO bot.py:37 - app.bot.bot - Starting bot
[2025-10-11 10:15:14,182] #DEBUG connect_to_pg.py:22 - app.infrastructure.database.connection.connect_to_pg - Building PostgreSQL connection string (password omitted): postgresql://postgres@127.0.0.1:5466/postgres
[2025-10-11 10:15:14,201] #INFO connect_to_pg.py:34 - app.infrastructure.database.connection.connect_to_pg - Connected to PostgreSQL version: PostgreSQL 17.6 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
[2025-10-11 10:15:14,243] #INFO bot.py:86 - app.bot.bot - Registering error handlers
[2025-10-11 10:15:14,244] #INFO bot.py:96 - app.bot.bot - Including routers
[2025-10-11 10:15:14,244] #INFO bot.py:99 - app.bot.bot - Including dialogs
[2025-10-11 10:15:14,244] #INFO bot.py:102 - app.bot.bot - Including middlewares
[2025-10-11 10:15:14,244] #INFO bot.py:108 - app.bot.bot - Including error middlewares
[2025-10-11 10:15:14,244] #INFO bot.py:114 - app.bot.bot - Setting up dialogs
[2025-10-11 10:15:14,245] #INFO bot.py:117 - app.bot.bot - Including observers middlewares
[2025-10-11 10:15:14,245] #INFO bot.py:123 - app.bot.bot - Starting taskiq broker
[2025-10-11 10:15:14,246] #INFO taskiq_broker.py:35 - app.services.scheduler.taskiq_broker - Taskiq broker disabled
[2025-10-11 10:15:14,246] #INFO dispatcher.py:566 - aiogram.dispatcher - Start polling
[2025-10-11 10:15:14,550] #INFO dispatcher.py:363 - aiogram.dispatcher - Run polling for bot @TestScanUserBot id=8275970023 - 'TestScanUserBot'
[2025-10-11 10:16:19,352] #ERROR database.py:34 - app.bot.middlewares.database - Transaction rolled back due to error: relation "users" does not exist
LINE 13: FROM users
^
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\database.py", line 32, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\get_user.py", line 31, in call
user_row: UserModel | None = await db.users.get_user(user_id=user.id)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\tables\users.py", line 56, in get_user
data: SingleQueryResult = await self.connection.fetchone(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<16 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\psycopg_connection.py", line 34, in fetchone
await cur.execute(sql, params)
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\cursor_async.py", line 97, in execute
raise ex.with_traceback(None)
psycopg.errors.UndefinedTable: relation "users" does not exist
LINE 13: FROM users
^
[2025-10-11 10:16:19,364] #INFO dispatcher.py:172 - aiogram.event - Update id=720762329 is not handled. Duration 14 ms by bot id=8275970023
[2025-10-11 10:16:19,364] #ERROR dispatcher.py:315 - aiogram.event - Cause exception while process update id=720762329 by bot id=8275970023
UndefinedTable: relation "users" does not exist
LINE 13: FROM users
^
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
response = await self.feed_update(bot, update, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
response = await self.update.wrap_outer_middleware(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<7 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram_dialog\manager\manager_middleware.py", line 80, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
return await wrapped_inner(event, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\database.py", line 32, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\get_user.py", line 31, in call
user_row: UserModel | None = await db.users.get_user(user_id=user.id)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\tables\users.py", line 56, in get_user
data: SingleQueryResult = await self.connection.fetchone(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<16 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\psycopg_connection.py", line 34, in fetchone
await cur.execute(sql, params)
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\cursor_async.py", line 97, in execute
raise ex.with_traceback(None)
psycopg.errors.UndefinedTable: relation "users" does not exist
LINE 13: FROM users
^


–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —Ç–µ–ø–µ—Ä—å —É—Å–ø–µ—à–Ω–æ–µ ‚Äî –±–æ—Ç —Å—Ç–∞—Ä—Ç—É–µ—Ç –∏ –≤—ã—Ö–æ–¥–∏—Ç –≤ polling. –û—à–∏–±–∫–∞ –¥–∞—ë—Ç —Å–∞–º–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∞–ø–¥–µ–π—Ç–µ middleware –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users, –∫–æ—Ç–æ—Ä–æ–π –≤ –ë–î –ø–æ–∫–∞ –Ω–µ—Ç.
–ß—Ç–æ–±—ã –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ, –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å —Å—Ö–µ–º—É. –í–∞—Ä–∏–∞–Ω—Ç—ã:
–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
cd F:\WORK\Python\shariat-from-template\bot
alembic upgrade head
–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å alembic.ini, —á—Ç–æ DSN —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ postgresql+psycopg://postgres:postgres@127.0.0.1:5466/postgres.
–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ, —Å–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é (–¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å CREATE TABLE users (...) –∏–∑ app/infrastructure/database/tables).
–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—Ö–µ–º–∞ –ø–æ—è–≤–∏—Ç—Å—è, –∑–∞–ø—É—Å—Ç–∏ python .\main.py –ø–æ–≤—Ç–æ—Ä–Ω–æ ‚Äî –æ—à–∏–±–∫–∞ UndefinedTable –∏—Å—á–µ–∑–Ω–µ—Ç –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—á–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

–≤—ã–ø–æ–ª–Ω–∏ —à–∞–≥–∏ 1 –∏ 2


–ó–∞–ø—É—Å—Ç–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ bot (..\\venv\\Scripts\\python.exe -m alembic upgrade head). –í –ª–æ–≥–µ –≤–∏–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–æ–≤ -> 1541bb8a3f26 –∏ 1541bb8a3f26 -> b20e5643d3bd.
–ü—Ä–æ–≤–µ—Ä–∏–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã: –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ psycopg –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã alembic_version –∏ users, –∑–Ω–∞—á–∏—Ç —Å—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ç–∞–±–ª–∏—Ü–∞ users –Ω–∞ –º–µ—Å—Ç–µ.
–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ ‚Äî –æ—à–∏–±–∫–∞ relation "users" does not exist –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è.

–ò—Ç–∞–∫ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ .old –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ä—ã–π –±–æ—Ç, –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –º–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å.
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Ç–∞–ª–æ–≥ .old –∏ –¥–∞–≤–∞–π –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–∫–∏–µ –∂–µ –º–µ–Ω—é, –∫–Ω–æ–ø–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã, –∫–∞–∫ –≤ —Å—Ç–∞—Ä–æ–º –±–æ—Ç–µ


–ú–µ–Ω—é –°—Ç–∞—Ä–æ–≥–æ –ë–æ—Ç–∞

Reply-–º–µ–Ω—é –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –≤ .old/Comitee-Bot-main/bot/src/handlers.py:596: 10 –∫–Ω–æ–ø–æ–∫ (üìÇ –ú–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã, ‚öñÔ∏è –ú–æ–∏ —Å—É–¥—ã, üéì –®–∞—Ä–∏–∞—Ç—Å–∫–∏–µ –ó–Ω–∞–Ω–∏—è, üó£ –°–æ–≤–µ—â–∞–Ω–∏—è, üëç –î–æ–±—Ä—ã–µ –¥–µ–ª–∞, üí∏ –ù–∞—Å–ª–µ–¥—Å—Ç–≤–æ –∏ –∑–∞–≤–µ—â–∞–Ω–∏—è, üéâ –ú—É—Å—É–ª—å–º–∞–Ω—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏, üíç –ù–∏–∫–∞—Ö, üí∞ –ó–∞–∫—è—Ç –∏ –°–∞–¥–∞–∫–∞, üìö –®–∞—Ä–∏–∞—Ç—Å–∫–∏–π –∫–æ–º–∏—Ç–µ—Ç) –ø–ª—é—Å —ç–º–æ–¥–∑–∏-–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –∏ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ src/utils.py.
–ü–æ–¥–º–µ–Ω—é ¬´üìÇ –ú–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã¬ª (button_data –≤ handlers.py:632) —Å–æ–¥–µ—Ä–∂–∏—Ç inline-–∫–Ω–æ–ø–∫–∏ üìã –í—Å–µ –º–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã (all_contracts), üîé –ù–∞–π—Ç–∏ –¥–æ–≥–æ–≤–æ—Ä (find_contract), üìë –°–æ–∑–¥–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä (create_contract), üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (contracts_stats); –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ handle_all_contracts, handle_find_contract, handle_create_contract, handle_contracts_stats, handle_back_to_contracts —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ handlers.py:744-828 –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Mongo-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π database/tools.py.
–ë–ª–æ–∫–∏ –∑–Ω–∞–Ω–∏–π –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ (üéì/üéâ) —Å—Ç—Ä–æ—è—Ç –∫–∞—Ç–∞–ª–æ–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (docs_tauhid/docs_faith/..., holiday_uraza/...) —Å –≤—ã–¥–∞—á–µ–π PDF —á–µ—Ä–µ–∑ send_documents_by_name_in_category –≤ handlers.py:110; –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (üó£, üëç, üí∏, üíç, üí∞, üìö) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–∫—Å—Ç –∏ –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏.
–†–∞–∑–¥–µ–ª ¬´‚öñÔ∏è –ú–æ–∏ —Å—É–¥—ã¬ª (handlers.py:841) –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º –¥–µ–ª (opened_cases, closed_cases, in_progress) –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫ –º–µ–Ω—é; —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è go_to_court –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–µ–ª –≤ —Å—Ç–∞—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, —á—Ç–æ —Å—Ç–æ–∏—Ç —É—á–µ—Å—Ç—å –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏.
–õ—é–±–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–Ω–µ —Å–ø–∏—Å–∫–∞ –º–µ–Ω—é –≤ handlers.py:918 —É—Ö–æ–¥–∏—Ç –≤ GPT (src/ai.py) –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è inline-—Å—Å—ã–ª–∫–∞–º–∏ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∂–∏–≤—ã–º —á–∞—Ç–∞–º; –æ—Ç–≤–µ—Ç—ã —É—á—ë–Ω—ã–º –∏ –æ–±—Ä–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ pending_questions, forward_question –∏ callback reply_{user_id}_{question_id} (—Å–º. handlers.py:985).
–°–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã

FSM ContractCreation –∏ ContractSearch (handlers.py:206-213) –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞, –∑–∞–≥—Ä—É–∑–∫—É PDF –∏ –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏; –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —à–∞–≥–∞ –º–µ–Ω—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ inline-–Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
FSM ScholarAnswers (handlers.py:198) –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã —É—á—ë–Ω—ã—Ö –ø–æ callback reply_‚Ä¶ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∏—Ö –∞–≤—Ç–æ—Ä–∞–º (–∑–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞ –≤–æ–ø—Ä–æ—Å–æ–≤).
–ë–î-—Å–ª–æ–π (database/tools.py) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MongoDB: –∫–æ–ª–ª–µ–∫—Ü–∏–∏ users –∏ documents, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ (database/documents/*). –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL (bot/app/infrastructure/database), –ø–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω—É–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å.
–ù–∞–±–ª—é–¥–µ–Ω–∏—è

–í —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å –∑–∞–≥–æ—Ç–æ–≤–∫–∏: bot/app/bot/handlers/comitee_menu.py –∏ comitee.py —Å–æ–∑–¥–∞—é—Ç —Å—Ç–∞—Ä—Ç–æ–≤—É—é inline-–∫–Ω–æ–ø–∫—É –∏ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –º–µ–Ω—é, –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ handlers/__init__.py –∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∫–Ω–æ–ø–æ–∫.
–¢–∞–±–ª–∏—Ü—ã PostgreSQL (documents, prompts, users) —É–∂–µ –æ–ø–∏—Å–∞–Ω—ã, –æ–¥–Ω–∞–∫–æ –º–µ—Ç–æ–¥—ã –≤—ã–±–æ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî –∏—Ö –ø—Ä–∏–¥—ë—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ parity.
–ù–∞–±–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ i18n –ø–æ–∫–∞ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –º–µ–Ω—é; –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞—à–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–¥, –∞ –∑–∞—Ç–µ–º –≤—ã–Ω–µ—Å—Ç–∏ –≤ prompts –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∏.
–ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–æ–≤—ã–π –±–æ—Ç

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∏ –ø–æ–¥–º–µ–Ω—é (reply + inline) –≤ –Ω–æ–≤–æ–º –º–æ–¥—É–ª–µ, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Ç–µ–∫—Å—Ç—ã, —ç–º–æ–¥–∑–∏ –∏ callback-data; –∑–∞–æ–¥–Ω–æ –æ–ø–∏—Å–∞—Ç—å, –∫–∞–∫–∏–µ –ø—É–Ω–∫—Ç—ã –≤–µ–¥—É—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ URL.
–†–∞—Å—à–∏—Ä–∏—Ç—å comitee_menu.py (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π router) –¥–ª—è /start: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞–∫ –≤ commands.py), –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –¥–∏–∞–ª–æ–≥, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ–Ω—é –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ F.text –¥–ª—è 10 –∫–Ω–æ–ø–æ–∫, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π inline-–º–µ–Ω—é; –¥–ª—è —á–∏—Å—Ç–æ —Å—Å—ã–ª–æ—á–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ InlineKeyboardMarkup.
–°–æ–∑–¥–∞—Ç—å StatesGroup –¥–ª—è ContractCreation –∏ ContractSearch –≤ bot/app/bot/states/states.py, –ø–æ–≤—Ç–æ—Ä–∏–≤ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —à–∞–≥–æ–≤, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä—É—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ–¥ PostgreSQL (documents —Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É).
–ù–∞–ø–∏—Å–∞—Ç—å callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (all_contracts, find_contract, create_contract, contracts_stats, checking_court_cases, back_to_contracts, docs_*, holiday_*, reply_*) –≤ –Ω–æ–≤–æ–º –º–æ–¥—É–ª–µ; –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (go_to_court, opened_cases, closed_cases, in_progress) —Ä–µ—à–∏—Ç—å, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å (—Ö–æ—Ç—è –±—ã –∑–∞–≥–ª—É—à–∫–∏).
–ü–æ–¥–∫–ª—é—á–∏—Ç—å router –≤ bot/app/bot/handlers/__init__.py –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ middleware (database, i18n, shadow_ban –∏ —Ç.–¥.) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, —á—Ç–æ–±—ã –¥–æ—Å—Ç—É–ø –∫ DB, translator_hub –∏ –ø—É–ª–∞–º –æ—Å—Ç–∞–≤–∞–ª—Å—è.
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ UI –ø—Ä–æ–¥—É–º–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏: –º–µ—Ç–æ–¥—ã DB.documents –¥–ª—è –≤—ã–±–æ—Ä–æ–∫, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è GPT (app/services) –∏ –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ —É—á—ë–Ω—ã–º.
–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥–ª—É—à–µ–∫ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ –±–µ–∑ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ (go_to_court, —Å—Ç–∞—Ç—É—Å—ã –¥–µ–ª, —Å—É–¥/–Ω–∏–∫—è—Ö).
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ–Ω—é (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã/Enum), —á—Ç–æ–±—ã –Ω–∞ –µ—ë –æ—Å–Ω–æ–≤–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö.
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (PostgreSQL bytea vs. —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞); –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏—Ç—å DocumentsTable –º–µ—Ç–æ–¥–∞–º–∏ —á—Ç–µ–Ω–∏—è/–ø–æ–∏—Å–∫–∞.
–ó–∞–¥–∞—á–∞ –Ω–æ–º–µ—Ä –æ–¥–∏–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
–ò–¥–µ—è —Ç–∞–∫–∞—è - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ –≤–µ–± –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —è–∑—ã–∫. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–±–µ—Ä–µ—Ç, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞–∫–æ–≥–æ —è–∑—ã–∫–∞ –Ω–æ–≤—ã–π —è–∑—ã–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ —Å —è–∑—ã–∫–∞-–æ—Å–Ω–æ–≤—ã —Å –ø–æ–º–æ—â—å—é –ò–ò.
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫ "DEV", –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –µ–º—É –≤–º–µ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–æ–≤ –±—É–¥—É—Ç –≤—ã–≤–µ–¥–µ–Ω—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã.
–í –≤–µ–± –ø–∞–Ω–µ–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤ –≤—ã–≥–ª—è–¥–∏—Ç: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä-–∑–Ω–∞—á–µ–Ω–∏–µ.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:

—è–∑—ã–∫–∏
id, –∫–æ–¥ —è–∑—ã–∫–∞, is_default
–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
id, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ
–ü–µ—Ä–µ–≤–æ–¥
id, id —è–∑—ã–∫–∞, id –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞, –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫

–ë–æ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤ –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∏—Ö —Å–æ–∑–¥–∞–µ—Ç –º–µ–Ω—é –¥–ª—è –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞.
–ï—Å–ª–∏ –∑–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ç–æ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –Ω–∞ —è–∑—ã–∫–µ is_default –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫.


–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å

–í —Ç–µ–∫—É—â–µ–º –±–æ—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Ç–µ–∫—Å—Ç–æ–≤ —Å–ª—É–∂–∏—Ç —Ç–∞–±–ª–∏—Ü–∞ prompts (bot/app/infrastructure/database/tables/prompts.py), –æ—Ç–∫—É–¥–∞ PromptsTable –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –∏ middleware DataBaseMiddleware –∫–ª–∞–¥—ë—Ç DB –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—É—â–Ω–æ—Å—Ç—å (bot/app/infrastructure/database/tables/users.py) —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç lang ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É —è–∑—ã–∫–æ–≤.
–î–∏–∞–ª–æ–≥–∏ (app/bot/dialogs/**), –∫–æ–º–∞–Ω–¥—ã –∏ –º–µ–Ω—é (app/bot/handlers/**) —É–º–µ—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å i18n, –Ω–æ —Ç–µ–∫—Å—Ç—ã –∂—ë—Å—Ç–∫–æ –ø—Ä–æ—à–∏—Ç—ã –∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ë–î.
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–æ–≤–æ–π –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏

–°—Ö–µ–º–∞ –ë–î

languages: id SERIAL, code TEXT UNIQUE, is_default BOOLEAN, is_dev BOOLEAN, fallback_language_id (–¥–ª—è —Ü–µ–ø–æ—á–∫–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è).
translation_keys: id SERIAL, identifier TEXT UNIQUE, description TEXT.
translations: id SERIAL, language_id, key_id, value TEXT. –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (language_id, key_id).
–í users: –∑–∞–º–µ–Ω–∏—Ç—å/—Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å lang –Ω–∞ language_id (FK –≤ languages).
–ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic: —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã + –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ prompts ‚Üí translation_keys/translations (–ª–∏–±–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤, –Ω–æ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Å—Ö–µ–º–∞).
–°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞

–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ app/infrastructure/database/tables/: LanguagesTable, TranslationKeysTable, TranslationsTable —Å –º–µ—Ç–æ–¥–æ–º ensure_schema.
–°–µ—Ä–≤–∏—Å–Ω—ã–π –æ–±—ä–µ–∫—Ç LocaleRepository (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ app/services/i18n/), –∫–æ—Ç–æ—Ä—ã–π –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, —Å—Ç—Ä–æ–∏—Ç —Å–ª–æ–≤–∞—Ä—å dict[identifier] -> value –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, —É—á–∏—Ç—ã–≤–∞—è fallback –∏ DEV.
–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ –≥—Ä—É–∑–∏–º –≤—Å–µ —è–∑—ã–∫–∏ –∏ —Å–ª–æ–≤–∞—Ä–∏ –≤ –ø–∞–º—è—Ç—å (bot.main ‚Üí dp.workflow_data).
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞

–ü—Ä–∏ CommandStart: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ—Ç —è–∑—ã–∫–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º inline-–º–µ–Ω—é —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–∑ –ë–î: is_default –Ω–∞ —Ç–µ–∫—Å—Ç–µ-–∑–∞–≥–ª—É—à–∫–µ ‚ÄúChoose language / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫‚Äù. –ö–Ω–æ–ø–∫–∞ DEV ‚Äî –æ—Ç–¥–∞—ë—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–π.
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å: LocaleService.set_language(user_id, language_code) ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º users.language_id, –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º reply-–º–µ–Ω—é —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏.
–í—Å–µ —Ç–µ–∫—Å—Ç—ã UI (–º–µ–Ω—é, –ø–æ–¥—Å–∫–∞–∑–∫–∏, –æ—à–∏–±–∫–∏) –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≤—ã–∑–æ–≤—ã translator.translate("menu.btn.contracts") –∏ —Ç.–ø. ‚Äî –∫–ª–∏–µ–Ω—Ç –≤—ã—Ç—è–Ω–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ –∫—ç—à–∞; –µ—Å–ª–∏ —è–∑—ã–∫ DEV, –≤–µ—Ä–Ω—ë—Ç —Å–∞–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
–ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ‚Äë–ø–µ—Ä–µ–≤–æ–¥–∞

–í –∞–¥–º–∏–Ω–∫–µ (–ø–æ–∫–∞ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π) –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —è–∑—ã–∫–∞: –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è base_language_id ‚Üí –±—ç–∫–µ–Ω–¥ —Ç—è–Ω–µ—Ç –≤—Å–µ translation_keys, —Å—Ç—Ä–æ–∏—Ç prompt —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –±–∞–∑–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç AI (–Ω–∞–ø—Ä–∏–º–µ—Ä, app/services/translation_service.py, –∏—Å–ø–æ–ª—å–∑—É—è Fireworks/OpenAI).
AI-–æ—Ç–≤–µ—Ç –ø–∞—Ä—Å–∏—Ç—Å—è –≤ —Å–ª–æ–≤–∞—Ä—å key -> value, —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ translations. –î–ª—è DEV –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã: value = identifier.
–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞: –µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –≤—Ä—É—á–Ω—É—é ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è.
–ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å

API: /languages (CRUD), /translations/{language} (GET/PUT —Å–ø–∏—Å–∫–∞ ‚Äú–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ‚Äù), /translations/generate (POST —Å target_language, base_language).
UI —Ç–∞–±–ª–∏—Ü—ã ‚Äú–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä ‚Äì –∑–Ω–∞—á–µ–Ω–∏–µ‚Äù. –î–ª—è —è–∑—ã–∫–∞ DEV –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –ø–æ–ª–µ ‚Äú–∑–Ω–∞—á–µ–Ω–∏–µ‚Äù read-only.
–í–∞–ª–∏–¥–∞—Ü–∏—è: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞/–ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ; –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º.
–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

–°–¥–µ–ª–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏ –Ω–æ–≤—ã–µ DAO.
–ù–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–æ–≤–∞—Ä–µ–π + –∫—ç—à –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞.
–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ö–∞—Ä–¥–∫–æ–¥‚Äë—Å—Ç—Ä–æ–∫–∏ –±–æ—Ç–∞ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–∏—Å—É –ø–µ—Ä–µ–≤–æ–¥–æ–≤.
–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –≤ /start, –æ–±–Ω–æ–≤–∏—Ç—å middleware, —á—Ç–æ–±—ã –≤ data["i18n"] –ª–µ–∂–∞–ª –æ–±—ä–µ–∫—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –ø–µ—Ä–µ–≤–æ–¥–∞–º –∏–∑ –ë–î.
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –∏ —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥–∞ (–º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º –º–æ–¥—É–ª–µ–º/–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–º).
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ ‚Äî —Ñ–æ—Ä–º—ã –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞ backend/frontend).
–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å–º–µ–Ω–∞ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Ä–µ–∂–∏–º DEV (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã), –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –∏ ÏûêÎèô-–ø–µ—Ä–µ–≤–æ–¥, fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞.
–ï—Å–ª–∏ —É—Å—Ç—Ä–æ–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –º–æ–≥—É –ø–µ—Ä–µ–π—Ç–∏ –∫ —à–∞–≥—É 1: –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ DAO.

–î–∞, –ø–µ—Ä–µ–π–¥–∏ –∫ —à–∞–≥—É 1


–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–∏–ª –º–∏–≥—Ä–∞—Ü–∏—é d9f5f0f0d1ab —Å –Ω–æ–≤—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ languages, translation_keys, translations, —á–∞—Å—Ç–∏—á–Ω—ã–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ FK users.language_id. –î–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è, –ø—Ä–∏ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç ru.
–°–æ–∑–¥–∞–ª DAO-—Å–ª–æ–π: LanguagesTable, TranslationKeysTable, TranslationsTable, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ enum‚Äô—ã –¥–ª—è –ª–æ–≥–æ–≤ –∏ –º–æ–¥–µ–ª–∏ LanguageModel, TranslationKeyModel, TranslationModel.
–†–∞—Å—à–∏—Ä–∏–ª DB –Ω–æ–≤—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏, –ø–µ—Ä–µ–≤—ë–ª UsersTable –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ language_id (—Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –æ–±–Ω–æ–≤–∏–ª UserModel, middleware i18n –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å language_code.
–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: poetry run alembic upgrade head (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥ –≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º venv) ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç—Ä–∏ –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –≤ users –ø–æ—è–≤–∏–ª—Å—è language_id.
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π / —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–∏–∞–ª–æ–≥ ‚Äî –∑–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –∏–¥—Ç–∏ –≤ users.language_id, –∞ –≤—ã–±–æ—Ä –ª–æ–∫–∞–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–¥–∞ —è–∑—ã–∫–∞ –∏–∑ join‚Äô–∞.
–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏–∑ –ë–î –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ fallback/DEV-—Ä–µ–∂–∏–º–∞ –Ω–∞ –±–∞–∑–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü.
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ UI-—Å—Ç—Ä–æ–∫–∏ –±–æ—Ç–∞ –≤ translation_keys/translations, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—ç—à –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±—ç–∫–µ–Ω–¥/–∞–¥–º–∏–Ω–∫—É –¥–ª—è CRUD –ø–æ —è–∑—ã–∫–∞–º –∏ –∫–ª—é—á–∞–º, –≤–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –±–∞–∑–µ –ò–ò.
16 files changed
+543
-13

Undo

View all changes
d9f5f0f0d1ab_multilanguage_tables.py
+201
-0

handlers.py
+5
-1

commands.py
+1
-1

i18n.py
+2
-2

db.py
+6
-0

language.py
+14
-0

translation.py
+15
-0

translation_key.py
+16
-0

user.py
+6
-2

languages.py
+10
-0

translation_keys.py
+7
-0

translations.py
+7
-0

languages.py
+91
-0

translation_keys.py
+72
-0

translations.py
+68
-0

users.py
+22
-7

(venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
[2025-10-11 19:13:41,032] #DEBUG selector_events.py:64 - asyncio - Using selector: SelectSelector
[2025-10-11 19:13:41,033] #INFO bot.py:37 - app.bot.bot - Starting bot
[2025-10-11 19:13:41,247] #DEBUG connect_to_pg.py:22 - app.infrastructure.database.connection.connect_to_pg - Building PostgreSQL connection string (password omitted): postgresql://postgres@127.0.0.1:5466/postgres
[2025-10-11 19:13:41,263] #INFO connect_to_pg.py:34 - app.infrastructure.database.connection.connect_to_pg - Connected to PostgreSQL version: PostgreSQL 17.6 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
[2025-10-11 19:13:41,300] #INFO bot.py:86 - app.bot.bot - Registering error handlers
[2025-10-11 19:13:41,301] #INFO bot.py:96 - app.bot.bot - Including routers
[2025-10-11 19:13:41,301] #INFO bot.py:99 - app.bot.bot - Including dialogs
[2025-10-11 19:13:41,301] #INFO bot.py:102 - app.bot.bot - Including middlewares
[2025-10-11 19:13:41,301] #INFO bot.py:108 - app.bot.bot - Including error middlewares
[2025-10-11 19:13:41,301] #INFO bot.py:114 - app.bot.bot - Setting up dialogs
[2025-10-11 19:13:41,303] #INFO bot.py:117 - app.bot.bot - Including observers middlewares
[2025-10-11 19:13:41,303] #INFO bot.py:123 - app.bot.bot - Starting taskiq broker
[2025-10-11 19:13:41,303] #INFO taskiq_broker.py:35 - app.services.scheduler.taskiq_broker - Taskiq broker disabled
[2025-10-11 19:13:41,303] #INFO dispatcher.py:566 - aiogram.dispatcher - Start polling
[2025-10-11 19:13:41,506] #INFO dispatcher.py:363 - aiogram.dispatcher - Run polling for bot @TestScanUserBot id=8275970023 - 'TestScanUserBot'
[2025-10-11 19:13:56,627] #ERROR database.py:34 - app.bot.middlewares.database - Transaction rolled back due to error: column reference "id" is ambiguous
LINE 2: SELECT id,
^
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\database.py", line 32, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\get_user.py", line 31, in call
user_row: UserModel | None = await db.users.get_user(user_id=user.id)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\tables\users.py", line 66, in get_user
data: SingleQueryResult = await self.connection.fetchone(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<18 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\psycopg_connection.py", line 34, in fetchone
await cur.execute(sql, params)
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\cursor_async.py", line 97, in execute
raise ex.with_traceback(None)
psycopg.errors.AmbiguousColumn: column reference "id" is ambiguous
LINE 2: SELECT id,
^
[2025-10-11 19:13:56,636] #INFO dispatcher.py:172 - aiogram.event - Update id=720762331 is not handled. Duration 14 ms by bot id=8275970023
[2025-10-11 19:13:56,636] #ERROR dispatcher.py:315 - aiogram.event - Cause exception while process update id=720762331 by bot id=8275970023
AmbiguousColumn: column reference "id" is ambiguous
LINE 2: SELECT id,
^
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
response = await self.feed_update(bot, update, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
response = await self.update.wrap_outer_middleware(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<7 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram_dialog\manager\manager_middleware.py", line 80, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
return await wrapped_inner(event, kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\database.py", line 32, in call
return await handler(event, data)
^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\bot\middlewares\get_user.py", line 31, in call
user_row: UserModel | None = await db.users.get_user(user_id=user.id)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\tables\users.py", line 66, in get_user
data: SingleQueryResult = await self.connection.fetchone(
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...<18 lines>...
)
^
File "F:\WORK\Python\shariat-from-template\bot\app\infrastructure\database\connection\psycopg_connection.py", line 34, in fetchone
await cur.execute(sql, params)
File "F:\WORK\Python\shariat-from-template\venv\Lib\site-packages\psycopg\cursor_async.py", line 97, in execute
raise ex.with_traceback(None)
psycopg.errors.AmbiguousColumn: column reference "id" is ambiguous
LINE 2: SELECT id,
^


–ò—Å–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å –≤ UsersTable.get_user (bot/app/infrastructure/database/tables/users.py:64): –¥–æ–±–∞–≤–∏–ª –∞–ª–∏–∞—Å—ã users AS u, languages AS l –∏ —è–≤–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã —É –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç psycopg.errors.AmbiguousColumn –ø–æ—Å–ª–µ JOIN‚Äô–∞ —Å –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π languages.
–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ (python bot/main.py) ‚Äî SELECT –±–æ–ª—å—à–µ –Ω–µ —É–ø–∞–¥—ë—Ç –Ω–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–º id.

1 file changed

Undo

View all changes
users.py
+16
-15

–î–∞–≤–∞–π —Ä–µ–∞–ª–∏–∑—É–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –≤ .old –±–æ—Ç–µ –∏ —Å–¥–µ–ª–∞–µ–º –ø–æ–ª–Ω—ã–π –ø–æ–≤—Ç–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞


–†–µ–∞–ª–∏–∑–æ–≤–∞–ª –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π ¬´—Å—Ç–∞—Ä–æ–≥–æ¬ª –±–æ—Ç–∞ –≤ bot/app/bot/handlers/comitee.py:40‚Äì782: –∫–æ–º–∞–Ω–¥—É /start —Ç–µ–ø–µ—Ä—å –¥–æ–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å reply-–º–µ–Ω—é (show_welcome_menu), –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ inline-–ø–æ–¥–º–µ–Ω—é, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–∏—Å–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ —É—á—ë–Ω—ã–º –∏ –æ—Ç–≤–µ—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
–†–∞—Å—à–∏—Ä–∏–ª —Ä–∞–±–æ—Ç—É —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (bot/app/infrastructure/database/tables/documents.py:11‚Äì104): –¥–æ–±–∞–≤–ª–µ–Ω —Å—Ç–æ–ª–±–µ—Ü type, –º–µ—Ç–æ–¥—ã –≤—ã–±–æ—Ä–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç–∏–ø—É –∏ –ø–æ–∏—Å–∫—É –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é; users –ø–æ–ª—É—á–∏–ª–∏ —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π —è–∑—ã–∫–æ–≤ (bot/app/infrastructure/database/tables/users.py:20‚Äì118).
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –ò–ò-–æ—Ç–≤–µ—Ç–æ–≤ (bot/app/services/ai/fireworks.py:1‚Äì61) –∏ –≤—ã–∑–æ–≤—ã –µ–≥–æ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤; /start —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ show_welcome_menu (bot/app/bot/handlers/commands.py:25‚Äì53).
–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM (bot/app/bot/states/comitee.py:1‚Äì11), —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏—è d9f5f0f0d1ab —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –∫–æ–ª–æ–Ω–∫–æ–π documents.type.
–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

–í—ã–ø–æ–ª–Ω–∏—Ç—å poetry run alembic upgrade head (–∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç) ‚Äî —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã —è–∑—ã–∫–æ–≤, –∫–æ–ª–æ–Ω–∫—É documents.type, –∏–Ω–¥–µ–∫—Å—ã.
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pip install -r bot/requirements-dev.txt) ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç openai.
–í .env –∑–∞–¥–∞—Ç—å SCHOLARS_GROUP_ID, AI_API_KEY, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ AI_BASE_URL/AI_MODEL; –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ —Å–º–æ—Ç—Ä—è—Ç –∏ –≤ settings.toml.
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (python bot/main.py) –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
/start ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –º–µ–Ω—é.
–ö–Ω–æ–ø–∫–∞ ¬´üìÇ –ú–æ–∏ –¥–æ–≥–æ–≤–æ—Ä—ã¬ª ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä/–ø–æ–∏—Å–∫/–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (–Ω—É–∂–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏).
¬´üéì –®–∞—Ä–∏–∞—Ç—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è¬ª/¬´üéâ –ú—É—Å—É–ª—å–º–∞–Ω—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏¬ª ‚Üí –≤—ã–¥–∞—á–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ documents.
–°–≤–æ–±–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ—Ç–≤–µ—Ç –ò–ò + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å —É—á—ë–Ω—ã–º –∏ –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç.
–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏–ª–∏ —è–∑—ã–∫–∞–º–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–µ DAO (db.documents, db.languages, db.translations).

12 files changed
+940
-39

Undo

View all changes
.env.example
+6
-1

d9f5f0f0d1ab_multilanguage_tables.py
+31
-0

__init__.py
+2
-1

comitee.py
+732
-31

commands.py
+4
-1

comitee.py
+14
-0

documents.py
+75
-5

__init__.py
+3
-0

fireworks.py
+68
-0

settings.toml
+3
-0

pyproject.toml
+1
-0

requirements.txt
+1
-0

venv) PS F:\WORK\Python\shariat-from-template\bot> python .\main.py
Traceback (most recent call last):
File "F:\WORK\Python\shariat-from-template\bot\main.py", line 6, in <module>
from app.bot import main
File "F:\WORK\Python\shariat-from-template\bot\app\bot_init_.py", line 1, in <module>
from .bot import main
File "F:\WORK\Python\shariat-from-template\bot\app\bot\bot.py", line 18, in <module>
from app.bot.handlers import routers
File "F:\WORK\Python\shariat-from-template\bot\app\bot\handlers_init_.py", line 2, in <module>
from .comitee import comitee_router
ImportError: cannot import name 'comitee_router' from 'app.bot.handlers.comitee' (F:\WORK\Python\shariat-from-template\bot\app\bot\handlers\comitee.py)


–ì–æ—Ç–æ–≤–æ: –¥–æ–±–∞–≤–∏–ª —ç–∫—Å–ø–æ—Ä—Ç comitee_router –≤ app.bot.handlers.comitee (—Å—Ç—Ä–æ–∫–∞ 33), –ø–æ—ç—Ç–æ–º—É –∏–º–ø–æ—Ä—Ç –∏–∑ handlers.__init__ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏—Ç. –¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–ª app.bot.states.__init__ —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π (contractCreation, ContractSearch, ScholarAnswers), —á—Ç–æ–±—ã –ø–∞–∫–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª—Å—è.

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ python main.py –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ bot, –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –±–µ–∑ ImportError.

2 files changed
+4
-0

Undo

View all changes
comitee.py
+1
-0

__init__.py
+3
-0

–ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞.
"
–ü—Ä–∏–≤–µ—Ç, Sergey!

–≠—Ç–æ —à–∞–±–ª–æ–Ω –±–æ—Ç–∞, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –ú–∏—Ö–∞–∏–ª–æ–º –ö—Ä—ã–∂–∞–Ω–æ–≤—Å–∫–∏–º. –ê–≤—Ç–æ—Ä–æ–º –∫—É—Ä—Å–æ–≤ –ø–æ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞–º –Ω–∞ –°—Ç–µ–ø–∏–∫–µ.
"
–≠—Ç–æ–≥–æ –≤–æ–æ–±—â–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –Ω–∞—à–µ–º –±–æ—Ç–µ.

–î–∞–ª—å—à–µ, —É –Ω–∞—Å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ eng –≤—ã–≤–æ–¥–∏—Ç—Å—è –º–µ–Ω—è—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
–ï—Å–ª–∏ —É –Ω–∞—Å –Ω–µ –∑–∞–≤–µ–¥–µ–Ω–æ —è–∑—ã–∫–∞, —Ç–æ –¥–æ–ª–∂–Ω—ã –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

–¢–∞–∫ –∂–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ help –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —à–∞–±–ª–æ–Ω–∞.
–ï–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.


stream disconnected before completion: stream closed before response.completed
4 files changed
+651
-460

Undo

View all changes
bot.py
+2
-4

comitee.py
+412
-336

commands.py
+54
-120

localization.py
+183
-0

